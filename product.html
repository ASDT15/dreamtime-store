
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
  <!-- Plyr CSS -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <style>
   
    :root {
      --bg-light: #ecdaea;
      --text-light: #000000;
      --bg-dark: #121212;
      --text-dark: #f0f0f0;
      --card-bg: #f9f9f9;
      --btn-bg: #ff87f1;
      --btn-hover: #ffffff;
      --link-color: #1e90ff;
    }
    /* ------------------------- */
    /* ğŸ‘‡ Ø¥Ø¶Ø§ÙØ© Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒÙˆØ¨ÙŠØ² */
    .cartoon-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§ÙØ§Øª Ø²Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· */
        background: url('https://www.transparenttextures.com/patterns/cubes.png'), #000000;
        opacity: 0.3;
        z-index: -1; /* Ø®Ù„Ù ÙƒÙ„ Ø´ÙŠØ¡ */
        pointer-events: none; /* Ù„Ø§ ØªØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø±Ø§Øª/Ø§Ù„Ø³Ø­Ø¨ */
    }

    body.dark-mode .cartoon-bg {
        /* ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø£Ùˆ Ø§Ù„Ø´ÙØ§ÙÙŠØ© */
        background: url('https://www.transparenttextures.com/patterns/cubes.png'), #000000; /* Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø· */
        opacity: 0.2; /* Ø´ÙØ§ÙÙŠØ© Ø£Ù‚Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
    }
    /* ğŸ‘† Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒÙˆØ¨ÙŠØ² */
    /* ------------------------- */

    body.dark-mode {
      --bg-light: #121212;
      --text-light: #f0f0f0;
      --card-bg: #2d2d2d;
      --btn-bg: #ffe6fa;
      --btn-hover: #ffffff;
      --link-color: #1e90ff;
    }
   /* ------------------------- */
/* New Overlay Loader styles with Image */
#loader {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(2, 2, 2, 0.5); /* Light mode background */
    z-index: 9999;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

body.dark-mode #loader {
    background: rgba(0, 0, 0, 0.8); /* Dark mode background */
}

.loader-content {
    text-align: center;
}

/* ØªÙ†Ø³ÙŠÙ‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loader-image {
    width: 100px; /* Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© */
    height: 100px; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙˆØ±Ø© */
    margin-bottom: 20px;
    /* Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØ¯ÙˆÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ÙÙ‚Ù… Ø¨Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ */
    /* animation: spin-image 2s linear infinite; */
}

/* Ù…ÙØªØ§Ø­ ØªØ­Ø±ÙŠÙƒ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
@keyframes spin-image {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ØªÙ†Ø³ÙŠÙ‚ Ù†Øµ "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„" */
.loader-text {
    font-size: 18px;
    color: #333; /* Light mode text */
    font-weight: 500;
}

body.dark-mode .loader-text {
    color: #fff; /* Dark mode text */
}
/* ------------------------- */
.loader-image {
    width: 100px;
    height: 100px;
    margin-bottom: 20px;
    /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† */
    animation: spin-image 2s linear infinite;
}
    
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000, #ffe8fe86);
            color: #000000;
            margin: 0;
            padding: 20px;
        }
    .product-container {
      max-width: 600px;
      margin: auto;
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: background 0.3s ease;
    }
    .add-to-cart-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: var(--btn-bg);
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .add-to-cart-btn:hover {
      background-color: var(--btn-hover);
    }
    .back-link {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 9999;
      text-decoration: none;
      color: var(--link-color);
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
    }
    .back-link:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background-color: #f0f0f0;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .loader-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--btn-bg), #ff4081);
      transition: width 0.3s ease;
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± */
    .image-gallery {
      position: relative;
      width: 100%;
      height: 400px;
      overflow: hidden;
      border-radius: 10px;
      margin-bottom: 10px;
      background-color: #333;
      touch-action: pan-y; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø£ÙÙ‚ÙŠ ÙÙ‚Ø· */
    }
    .image-gallery .item {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .image-gallery .item.active {
      opacity: 1;
    }
    .image-gallery .item img,
    .image-gallery .item video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      border: 3px solid var(--btn-bg);
      /* Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-user-drag: none;
      -khtml-user-drag: none;
      -moz-user-drag: none;
      -o-user-drag: none;
      pointer-events: none; /* Ù…Ù†Ø¹ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ */
    }
    .dots-container {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .dot {
      height: 8px;
      width: 8px;
      background-color: #bbb;
      border-radius: 50%;
      margin: 0 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .dot.active {
      background-color: var(--btn-bg);
    }
    .error-message {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª */
    .size-controls {
      display: flex;
      gap: 5px;
      margin: 15px 0;
      justify-content: center;
    }
    .size-btn {
      padding: 8px 15px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    .size-btn:hover {
      background-color: #e0e0e0;
    }
    .size-btn.active {
      background-color: var(--btn-bg);
      color: white;
      border-color: var(--btn-bg);
    }
  </style>
  <!-- ğŸ‘‡ Script Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
  <script>
    // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù…Ø© ÙˆØ·Ø¨Ù‚Ù‡Ø§
    document.addEventListener("DOMContentLoaded", function () {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            // Ensure light mode is active if 'dark' is not explicitly saved
            document.body.classList.remove('dark-mode');
        }
    });
  </script>
</head>
<body>
  <!-- ğŸ‘‡ Ø¥Ø¶Ø§ÙØ© Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒÙˆØ¨ÙŠØ² -->
  <div class="cartoon-bg"></div>
  <!-- ğŸ‘‡ New Overlay Loader HTML -->
<div id="loader">
  <div class="loader-content">
    <!-- Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø³Ø¨ÙŠÙ†Ø± Ø¨ØµÙˆØ±Ø© -->
    <img src="LOGO.png" alt="ØªØ­Ù…ÙŠÙ„" class="loader-image">
    <div class="loader-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</div>
<!-- ğŸ‘† New Overlay Loader HTML -->

  <!-- ğŸ‘‡ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø± ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© -->
  <a href="index.html" class="back-link" style="position: fixed; top: 20px; left: 20px; z-index: 9999;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</a>
 
  <!-- ğŸ“¦ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="product-container" id="productDetails">
    <h2 id="productName">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬...</h2>
    <div class="image-gallery" id="imageGallery">...</div>
    <div class="dots-container" id="dotsContainer"></div>
    <div id="errorMsg" class="error-message" style="display:none;"></div>
    <p id="productDesc"></p>
    <p id="productPrice"></p>
    <!-- ğŸ‘‡ Ø£Ø²Ø±Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³ -->
    <div class="size-controls">
      <button class="size-btn" onclick="selectSize('S')">S</button>
      <button class="size-btn" onclick="selectSize('M')">M</button>
      <button class="size-btn" onclick="selectSize('L')">L</button>
      <button class="size-btn" onclick="selectSize('XL')">XL</button>
    </div>
    <!-- ğŸ‘‡ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© -->
    <button class="add-to-cart-btn" onclick="addToCart()">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
  </div>
  <!-- ğŸ‘‡ Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ø§Ù„Ø®Ù„ÙÙŠ -->
  <audio id="addSound" src="athfo.mp3"></audio>
  <!-- Plyr JS (Polyfilled version for wider browser support) -->
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script>
    // ØªØ¹Ø±ÙŠÙ Ø¹Ù†ÙˆØ§Ù† API
    const API_BASE_URL = 'http://localhost:3000';
    // Ø§Ù„Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ
    let currentProduct = null;
    let currentIndex = 0;
    let selectedSize = 'M'; // Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    let autoSlideInterval;
    let plyrInstances = []; // Array to hold Plyr instances for cleanup
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„Ø³Ø­Ø¨
    let startX = 0;
    let startY = 0;
    let endX = 0;
    let endY = 0;
    let isSwiping = false;
    
  
    // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ID Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    function getProductIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return parseInt(urlParams.get('id'));
    }
    // âœ… Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† API
    async function fetchProductFromAPI(productId) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/products/${productId}`);
        if (!response.ok) {
          if (response.status === 404) {
            throw new Error('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        }
        const product = await response.json();
        return product;
      } catch (error) {
        console.error('Error fetching product from API:', error);
        throw error;
      }
    }
    // âœ… Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù (Ù…Ø­Ø³Ù‘Ù†Ø©)
    function getFileType(src) {
      if (typeof src !== 'string') return 'unknown';
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Base64
      if (src.startsWith('')) {
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†ÙˆØ¹ MIME (Ù…Ø«Ù„Ø§Ù‹: data:image/jpeg;base64,...)
        const mimeType = src.split(';')[0].split(':')[1]?.toLowerCase();
        if (mimeType && mimeType.startsWith('image/')) return 'image';
        if (mimeType && mimeType.startsWith('video/')) return 'video';
        return 'unknown'; // Ù†ÙˆØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Base64 ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…
      }
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù†Ø§ÙˆÙŠÙ† URL Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
      const lowerSrc = src.toLowerCase();
      const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'];
      const videoExtensions = ['.mp4', '.avi', '.mov', '.wmv', '.webm'];
      if (imageExtensions.some(ext => lowerSrc.includes(ext))) return 'image';
      if (videoExtensions.some(ext => lowerSrc.includes(ext))) return 'video';
      // Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡Ø§ ØµÙˆØ±Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† ÙˆØ§Ø¶Ø­Ø©
      console.warn(`Could not determine type for URL: ${src}, defaulting to image.`);
      return 'image';
    }
    
    // âœ… Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª (Ù…Ø­Ø³Ù‘Ù†) - Plyr ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶
    function renderMedia(product) {
      console.log("Starting renderMedia with product:", product);
      const imageGallery = document.getElementById("imageGallery");
      const dotsContainer = document.getElementById("dotsContainer");
      if (!imageGallery || !dotsContainer) return;
      // Cleanup previous Plyr instances
      plyrInstances.forEach(player => {
        if (player && typeof player.destroy === 'function') {
            player.destroy();
        }
      });
      plyrInstances = [];
      imageGallery.innerHTML = '';
      dotsContainer.innerHTML = '';
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ÙˆØ³Ø§Ø¦Ø· - ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨
      let mediaArray = [];
      // 1. Ø£Ø¶Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
      if (product.videos && Array.isArray(product.videos)) {
        mediaArray = [...mediaArray, ...product.videos];
      }
      // 2. Ø«Ù… Ø£Ø¶Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      if (product.main_image_url) {
        mediaArray.push(product.main_image_url);
      }
      // 3. Ø«Ù… Ø£Ø¶Ù Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
      if (product.images && Array.isArray(product.images)) {
        mediaArray = [...mediaArray, ...product.images];
      }
      // **Fix: Ensure main_image_url is not duplicated if it's also in the images array**
      // Create a unique list based on value and order of appearance
       const uniqueMediaArray = [];
       const seen = new Set();
       mediaArray.forEach(src => {
         if (src && !seen.has(src)) { // Check if src is not null/empty and not already seen
           seen.add(src);
           uniqueMediaArray.push(src);
         }
       });
       mediaArray = uniqueMediaArray; // Use the deduplicated array
      if (mediaArray.length === 0) {
        console.log("No media found, showing placeholder");
        // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø­Ù„ÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
        imageGallery.innerHTML = '<img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\' viewBox=\'0 0 200 200\'%3E%3Crect width=\'200\' height=\'200\' fill=\'%23cccccc\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-family=\'sans-serif\' font-size=\'20\' fill=\'%23666666\'%3EÙ„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©%3C/text%3E%3C/svg%3E" alt="Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©" style="width:100%; height:100%; object-fit: contain;">';
        return;
      }
      // **Fix: Reset currentIndex before processing new media**
      currentIndex = 0;
      mediaArray.forEach((src, index) => {
        console.log(`Processing media item ${index}:`, src);
        const itemDiv = document.createElement("div");
        itemDiv.classList.add("item");
        if (index === 0) itemDiv.classList.add("active"); // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ÙˆÙ„ Ù†Ø´Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
        const fileType = getFileType(src); // Use the improved function
        console.log(`Detected file type for item ${index}:`, fileType);
        if (fileType === 'video') {
          console.log(`Creating video element for item ${index}`);
          const video = document.createElement("video");
          video.src = src;
          // Ø¥Ø¶Ø§ÙØ© Ø®ØµØ§Ø¦Øµ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„ØµØ§Ù…Øª
          video.autoplay = true;   // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
          video.muted = true;      // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ØµØ§Ù…ØªÙ‹Ø§ (Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
          video.loop = true;       // ØªÙƒØ±Ø§Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
          video.playsInline = true; // Ù…Ù‡Ù… Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
          // Remove standard controls as Plyr will provide them
          // video.controls = true;
          video.style.maxWidth = "100%";
          video.style.maxHeight = "100%";
          video.style.objectFit = "contain";
          video.style.opacity = "1";
          video.style.backgroundColor = "#000";
          // Add class for Plyr identification
          video.classList.add('plyr-video');
          video.addEventListener('loadeddata', function () {
            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ${index} Ø¨Ù†Ø¬Ø§Ø­`);
          }, false);
          video.addEventListener('error', function (e) {
            console.error(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ${index}:`, e);
             this.onerror = null; // prevents infinite loop
             this.insertAdjacentHTML('beforebegin', `<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</p>`);
             this.remove();
          }, false);
          itemDiv.appendChild(video);
          // --- Initialize Plyr for the video in the gallery ---
          // Use a slight delay to ensure it's appended to the DOM
          setTimeout(() => {
              try {
                  const player = new Plyr(video, {
                      // Add Plyr options here (e.g., i18n for Arabic, controls layout)
                       muted: true, // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
                       i18n: {
                            restart: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„",
                            rewind: "Ø§Ù„ØªØ±Ø¬ÙŠØ¹ {seektime} Ø«Ø§Ù†ÙŠØ©",
                            play: "ØªØ´ØºÙŠÙ„",
                            pause: "Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª",
                            fastForward: "Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹ {seektime} Ø«Ø§Ù†ÙŠØ©",
                            seek: "Ø¨Ø­Ø«",
                            seekLabel: "{currentTime} Ù…Ù† {duration}",
                            played: "ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„",
                            buffered: "ØªÙ… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª",
                            currentTime: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ",
                            duration: "Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©",
                            volume: "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª",
                            mute: "ÙƒØªÙ… Ø§Ù„ØµÙˆØª",
                            unmute: "Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª",
                            enableCaptions: "ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªØ³Ù…ÙŠØ§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©",
                            disableCaptions: "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ³Ù…ÙŠØ§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©",
                            download: "ØªØ­Ù…ÙŠÙ„",
                            enterFullscreen: "Ø¯Ø®ÙˆÙ„ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©",
                            exitFullscreen: "Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©",
                            frameTitle: "Ù…Ø´ØºÙ„ Ù„Ù€ {title}",
                            captions: "Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª",
                            settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
                            menuBack: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
                            speed: "Ø§Ù„Ø³Ø±Ø¹Ø©",
                            normal: "Ø¹Ø§Ø¯ÙŠ",
                            quality: "Ø§Ù„Ø¬ÙˆØ¯Ø©",
                            loop: "ØªÙƒØ±Ø§Ø±",
                            start: "Ø§Ø¨Ø¯Ø£",
                            end: "Ù†Ù‡Ø§ÙŠØ©",
                            all: "Ø§Ù„ÙƒÙ„",
                            reset: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†",
                            disabled: "Ù…Ø¹Ø·Ù„",
                            enabled: "Ù…Ù…ÙƒÙ‘Ù†",
                            advertisement: "Ø¥Ø¹Ù„Ø§Ù†",
                            qualityBadge: {
                                2160: "4K",
                                1440: "HD",
                                1080: "HD",
                                720: "HD",
                                576: "SD",
                                480: "SD",
                            }
                        }
                  });
                  plyrInstances.push(player); // Store instance for potential cleanup
                  console.log("Plyr initialized for gallery video:", src);
              } catch (err) {
                   console.error("Failed to initialize Plyr for gallery video:", src, err);
                   // Fallback to default controls if Plyr fails
                   video.controls = true;
              }
          }, 0);
        } else if (fileType === 'image') {
          console.log(`Creating image element for item ${index}`);
          const img = document.createElement("img");
          img.src = src;
          img.alt = `ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ ${index + 1}`;
          img.onload = function () {
            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ${index} Ø¨Ù†Ø¬Ø§Ø­`);
            this.style.opacity = "1";
          };
          img.onerror = function () {
            console.error(`âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©: ${src}`);
            this.onerror = null; // Prevents infinite loop
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© SVG Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¶Ù…Ù†Ø© Ø¹Ù†Ø¯ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
            this.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23cccccc'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23666666'%3EØµÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©%3C/text%3E%3C/svg%3E";
            this.alt = "ØµÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©";
            this.style.opacity = "1";
          };
          img.style.maxWidth = "100%";
          img.style.maxHeight = "100%";
          img.style.objectFit = "contain";
          img.style.opacity = "0";
          img.style.transition = "opacity 0.5s ease-in-out";
          itemDiv.appendChild(img);
        } else {
          console.warn(`Ù†ÙˆØ¹ Ù…Ù„Ù ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ùˆ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…: ${src}`);
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© SVG Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¶Ù…Ù†Ø© Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…
          const placeholderImg = document.createElement("img");
          placeholderImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23cccccc'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23666666'%3EÙ…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…%3C/text%3E%3C/svg%3E";
          placeholderImg.alt = "Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…";
          placeholderImg.style.maxWidth = "100%";
          placeholderImg.style.maxHeight = "100%";
          placeholderImg.style.objectFit = "contain";
          placeholderImg.style.opacity = "1";
          itemDiv.appendChild(placeholderImg);
        }
        imageGallery.appendChild(itemDiv);
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± (Ø§Ù„Ù†Ù‚Ø§Ø·)
        const dot = document.createElement("span");
        dot.classList.add("dot");
        if (index === 0) dot.classList.add("active");
        dot.addEventListener("click", () => {
          currentIndex = index;
          showCurrentItem();
          resetAutoSlide();
        });
        dotsContainer.appendChild(dot);
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø³Ø­Ø¨
      addSwipeListeners(imageGallery);
      
      // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† currentIndex Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶
      currentIndex = 0;
      showCurrentItem(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø³Ø­Ø¨
    function addSwipeListeners(element) {
      element.addEventListener('touchstart', handleTouchStart, false);
      element.addEventListener('touchmove', handleTouchMove, false);
      element.addEventListener('touchend', handleTouchEnd, false);
      
      // Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø¹Ù… Ø§Ù„Ù…Ø§ÙˆØ³
      element.addEventListener('mousedown', handleMouseDown, false);
      element.addEventListener('mousemove', handleMouseMove, false);
      element.addEventListener('mouseup', handleMouseUp, false);
      element.addEventListener('mouseleave', handleMouseUp, false);
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³
    function handleTouchStart(e) {
      const touch = e.touches[0];
      startX = touch.clientX;
      startY = touch.clientY;
      isSwiping = true;
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ù…Ø³
    function handleTouchMove(e) {
      if (!isSwiping) return;
      const touch = e.touches[0];
      endX = touch.clientX;
      endY = touch.clientY;
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³
    function handleTouchEnd(e) {
      if (!isSwiping) return;
      isSwiping = false;
      
      const diffX = startX - endX;
      const diffY = startY - endY;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø­Ø¨ Ø£ÙÙ‚ÙŠÙ‹Ø§ Ø¨Ø¯Ø±Ø¬Ø© ÙƒØ§ÙÙŠØ©
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
          nextItem();
        } else {
          // Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          prevItem();
        }
      }
    }
        // âœ… Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ *Ø§Ù„Ø¹Ù„ÙˆÙŠ* (Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
    function showTopLoader() {
      const loaderBar = document.getElementById("loaderBar");
      if (!loaderBar) return;
      loaderBar.parentElement.style.display = "block";
      loaderBar.style.width = "0%";
      requestAnimationFrame(() => {
        loaderBar.style.width = "100%";
      });
    }

    // âœ… Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ *Ø§Ù„Ø¹Ù„ÙˆÙŠ* (Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
    function hideTopLoader(delay = 500) {
      setTimeout(() => {
        const loaderBar = document.getElementById("loaderBar");
        if (!loaderBar) return;
        loaderBar.style.width = "0%";
        setTimeout(() => {
          loaderBar.parentElement.style.opacity = "0";
        }, 300);
        setTimeout(() => {
          loaderBar.parentElement.style.display = "none";
          loaderBar.parentElement.style.opacity = "1";
        }, 800);
      }, delay);
    }

    // âœ… Ø¹Ø±Ø¶ *Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„ÙƒØ§Ù…Ù„* Ø§Ù„Ø¬Ø¯ÙŠØ¯
    function showLoader() {
        const loaderOverlay = document.getElementById("loader");
        if (loaderOverlay) {
            loaderOverlay.style.display = 'flex'; // Use flex to center content
        }
        // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹ Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø£ÙŠØ¶Ø§Ù‹
        // showTopLoader();
    }

    // âœ… Ø¥Ø®ÙØ§Ø¡ *Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„ÙƒØ§Ù…Ù„* Ø§Ù„Ø¬Ø¯ÙŠØ¯
    function hideLoader(delay = 500) {
        setTimeout(() => {
            const loaderOverlay = document.getElementById("loader");
            if (loaderOverlay) {
                loaderOverlay.style.display = 'none';
            }
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹ Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø£ÙŠØ¶Ø§Ù‹
            // hideTopLoader(0); // Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ
        }, delay);
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ù…Ø§ÙˆØ³
    function handleMouseDown(e) {
      startX = e.clientX;
      startY = e.clientY;
      isSwiping = true;
      e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§ÙˆØ³
    function handleMouseMove(e) {
      if (!isSwiping) return;
      endX = e.clientX;
      endY = e.clientY;
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ù…Ø§ÙˆØ³
    function handleMouseUp(e) {
      if (!isSwiping) return;
      isSwiping = false;
      
      const diffX = startX - endX;
      const diffY = startY - endY;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø­Ø¨ Ø£ÙÙ‚ÙŠÙ‹Ø§ Ø¨Ø¯Ø±Ø¬Ø© ÙƒØ§ÙÙŠØ©
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
          nextItem();
        } else {
          // Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          prevItem();
        }
      }
    }
    
    // âœ… Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
    async function displayProductDetails() {
      showLoader();
      const errorMsg = document.getElementById("errorMsg");
      errorMsg.style.display = "none";
      try {
        const productId = getProductIdFromURL();
        if (!productId) {
          throw new Error("Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.");
        }
        currentProduct = await fetchProductFromAPI(productId);
        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        document.getElementById("productName").textContent = currentProduct.name;
        document.getElementById("productDesc").textContent = currentProduct.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ù†ØªØ¬.";
        document.getElementById("productPrice").textContent = `Ø§Ù„Ø³Ø¹Ø±: ${currentProduct.price} Ø±ÙŠØ§Ù„`;
        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
        renderMedia(currentProduct);
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø´Ùˆ
        startAutoSlide();
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø±
        initDotsClickHandler();
      } catch (error) {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬:", error);
        let errorMessage = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬.";
        if (error.message === 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.') {
          errorMessage = `Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (ID: ${productId}).`;
        } else if (error.message.includes('HTTP error! status:')) {
          errorMessage = `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`;
        }
        errorMsg.textContent = errorMessage;
        errorMsg.style.display = "block";
        document.getElementById("productName").textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
      } finally {
        hideLoader();
      }
    }

    // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø´Ùˆ
    function showCurrentItem() {
      const items = document.querySelectorAll(".image-gallery .item");
      const dots = document.querySelectorAll(".dot");
      items.forEach((item, index) => {
        item.classList.toggle("active", index === currentIndex);
      });
      dots.forEach((dot, index) => {
        dot.classList.toggle("active", index === currentIndex);
      });
    }
    // âœ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ
    function nextItem() {
      const items = document.querySelectorAll(".image-gallery .item");
      currentIndex = (currentIndex + 1) % items.length;
      showCurrentItem();
      resetAutoSlide();
    }
    // âœ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø³Ø§Ø¨Ù‚
    function prevItem() {
      const items = document.querySelectorAll(".image-gallery .item");
      currentIndex = (currentIndex - 1 + items.length) % items.length;
      showCurrentItem();
      resetAutoSlide();
    }
    // âœ… Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø´Ùˆ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    function startAutoSlide() {
      clearInterval(autoSlideInterval); // Ù…Ø³Ø­ Ø£ÙŠ ÙØ§ØµÙ„ Ø²Ù…Ù†ÙŠ Ø³Ø§Ø¨Ù‚
      autoSlideInterval = setInterval(nextItem, 3000); // ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
    }
    // âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø´Ùˆ
    function resetAutoSlide() {
      clearInterval(autoSlideInterval);
      startAutoSlide();
    }
    // âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø±
    function initDotsClickHandler() {
      const dots = document.querySelectorAll(".dot");
      dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          currentIndex = index;
          showCurrentItem();
          resetAutoSlide(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø´Ùˆ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
        });
      });
    }
    // âœ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³
    function selectSize(size) {
      selectedSize = size;
      const sizeButtons = document.querySelectorAll(".size-btn");
      sizeButtons.forEach(btn => {
        if (btn.textContent === size) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }
    // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
    function addToCart() {
      if (!currentProduct) {
        alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©!");
        return;
      }
      // Ù†Ø³Ø® Ø§Ù„ÙƒØ§Ø¦Ù† Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
      const productToAdd = {
        id: currentProduct.id,
        name: currentProduct.name,
        price: currentProduct.price,
        description: currentProduct.description,
        // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£Ùˆ Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ù…ØªØ§Ø­Ø©
        image: currentProduct.main_image_url || (currentProduct.images && currentProduct.images[0]) || (currentProduct.media && currentProduct.media[0]) || "placeholder.jpg",
        type: currentProduct.type || "ØºÙŠØ± Ù…ØµÙ†Ù"
        // Ø£Ø¶Ù Ø£ÙŠ Ø®ØµØ§Ø¦Øµ Ø£Ø®Ø±Ù‰ Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø³Ù„Ø©
      };
      let cart = JSON.parse(localStorage.getItem("dreamtime_cart")) || [];
      const existingItem = cart.find(item => item.id === productToAdd.id);
      if (existingItem) {
        existingItem.quantity += 1;
        existingItem.size = selectedSize; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ù…
      } else {
        cart.push({ ...productToAdd, quantity: 1, size: selectedSize });
      }
      localStorage.setItem("dreamtime_cart", JSON.stringify(cart));
      const addSound = document.getElementById('addSound');
      if (addSound) {
        addSound.currentTime = 0;
        addSound.play().catch(err => console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", err));
      }
      alert(productToAdd.name + " ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!");
    }
    // âœ… ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = displayProductDetails;
  </script>
</body>
>>>>>>> 1ca9840fd7669e69ef9fcfdb733ea761df62ea9d
</html>